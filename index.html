<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beranda</title>
  <link rel="stylesheet" href="style.css" />

<nav>
  <a href="index.html">Beranda</a>
  <a href="about.html">Tentang</a>
  <a href="contact.html">Kontak</a>
</nav>
<body>

<h1>Rupa-rupaning Laras, by Gialle</h1>
  <p>Bermacam-macam laras dan surupan, silakan bereksplorasi!</p>

<div>
  <label>Basis Nada:
    <select id="baseType">
      <option value="hz">Hz</option>
      <option value="midi">MIDI</option>
    </select>
  </label>
  <input type="number" id="baseValue" value="220" style="width:80px"> 
  <label>+ Cents: <input type="number" id="offsetCents" value="0" style="width:60px"></label>
  <label>Oscillator:
    <select id="oscType">
      <option value="sine">Sinus</option>
      <option value="square">Persegi</option>
      <option value="triangle">Segitiga</option>
      <option value="sawtooth">Gergaji</option>
    </select>
  </label>
</div>
<select id="scaleSelect"></select>
<div id="scaleContainer"></div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const activeNotes = {};
const keyBindings = [];
const keyMap = "1234567890qwertyuiopasdfghjklzxcvbnm,.;/";

// Generator untuk EDO
function generateEDO(names, edo, colors) {
  return names.map((name, i) => ({
    name: name,
    cents: Math.round(i * 1200 / edo),
    cls: colors[i % colors.length]
  }));
}

const names15 = ["Tugu","Singgul+","Tugu-","Singgul","Galimer+","Singgul-",
"Galimer","Panelu","Galimer-","Panelu-","Loloran+","Panelu-","Loloran","Tugu+","Loloran+"];
const colors15 = ["ruby","aqua","gold"];

const names17 = ["Tugu","Sorog+","Tugu-","Sorog","Singgul+","Sorog-","Singgul",
"Galimer","Singgul-","Galimer-","Panelu","Bungur+","Panelu-","Bungur","Loloran+","Bungur-","Loloran"];
const colors17 = ["ruby","aqua","gold","ruby","aqua","gold","ruby","ruby",
"aqua","gold","ruby","aqua","gold","ruby","aqua","gold","ruby"];

const scales = {
  salendro: [ 
    {name:"Tugu<br>1",cents:0,cls:"ruby"},
    {name:"Singgul<br>5",cents:240,cls:"orng"},
    {name:"Galimer<br>4",cents:480,cls:"emra"},
    {name:"Panelu<br>3",cents:720,cls:"turq"},
    {name:"Loloran<br>2",cents:960,cls:"amet"}
  ],
  degung: [ 
    {name:"Tugu<br>1",cents:0,cls:"ruby"},
    {name:"Singgul<br>5",cents:386,cls:"gold"},
    {name:"Galimer<br>4",cents:498,cls:"emra"},
    {name:"Panelu<br>3",cents:702,cls:"turq"},
    {name:"Loloran<br>2",cents:1088,cls:"amet"}
  ],
  madenda: [ 
    {name:"Tugu<br>1",cents:0,cls:"ruby"},
    {name:"Singgul<br>5",cents:386,cls:"gold"},
    {name:"Galimer<br>4",cents:590,cls:"moss"},
    {name:"Panelu<br>3",cents:702,cls:"turq"},
    {name:"Loloran<br>2",cents:1088,cls:"amet"}
  ],
  uni: [ 
    {name:"Tugu<br>1",cents:0,cls:"ruby"},
    {name:"Tugu-<br>-1",cents:112,cls:"aqua"},
    {name:"Sorog<br>+5",cents:204,cls:"aqua"},
    {name:"Singgul<br>5",cents:386,cls:"ruby"},
    {name:"Galimer<br>4",cents:498,cls:"ruby"},
    {name:"Galimer-<br>-4",cents:590,cls:"aqua"},
    {name:"Panelu<br>3",cents:702,cls:"ruby"},
    {name:"Bungur<br>-3",cents:884,cls:"aqua"},
    {name:"Loloran+<br>+2",cents:1018,cls:"aqua"},
    {name:"Loloran<br>2",cents:1088,cls:"ruby"}
  ],
  "15EDO": generateEDO(names15, 15, colors15),
  "17EDO": generateEDO(names17, 17, colors17)
};

function midiToHz(midi) {
  return 440 * Math.pow(2, (midi-69)/12);
}

function getBaseFreq() {
  const type = document.getElementById("baseType").value;
  const val = parseFloat(document.getElementById("baseValue").value);
  return (type==="hz") ? val : midiToHz(val);
}

function startNote(key, cents) {
  if (activeNotes[key]) return;
  const offset = parseFloat(document.getElementById("offsetCents").value) || 0;
  const baseFreq = getBaseFreq();
  const freq = baseFreq * Math.pow(2, (cents+offset)/1200);
  const oscType = document.getElementById("oscType").value;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = oscType;
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  activeNotes[key] = {osc, gain};
}

function stopNote(key) {
  if (!activeNotes[key]) return;
  const { osc, gain } = activeNotes[key];
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1);
  osc.stop(audioCtx.currentTime + 1);
  delete activeNotes[key];
}

function buildScaleUI() {
  const scaleName = document.getElementById("scaleSelect").value;
  const rows = scales[scaleName];
  const container = document.getElementById("scaleContainer");
  container.innerHTML = "";
  keyBindings.length = 0;
  let idx = 0;
  for (let o=0; o<5; o++) {
    rows.forEach((note,i)=>{
      const cents = note.cents + (1200*o);
      const keyId = scaleName+o+i;
      const keyChar = keyMap[idx++] || "";
      const a = document.createElement('a');
      a.className = note.cls;
      a.innerHTML = `${note.name}<br>[${keyChar}]<br>${cents}c`;
      a.onmousedown=()=>startNote(keyId,cents);
      a.onmouseup=a.onmouseleave=()=>stopNote(keyId);
      a.ontouchstart=(e)=>{e.preventDefault();startNote(keyId,cents);};
      a.ontouchend=()=>stopNote(keyId);
      container.appendChild(a);
      keyBindings.push({key:keyChar, id:keyId, cents});
    });
    container.appendChild(document.createElement('br'));
  }
}

document.getElementById("scaleSelect").addEventListener("change", buildScaleUI);
document.getElementById("baseType").addEventListener("change", () => {
  document.getElementById("baseValue").value = (document.getElementById("baseType").value==="hz"?440:69);
});
document.addEventListener('keydown', (e) => {
  if (e.repeat) return;
  const b = keyBindings.find(b => b.key === e.key);
  if (b) startNote(b.id, b.cents);
});
document.addEventListener('keyup', (e) => {
  const b = keyBindings.find(b => b.key === e.key);
  if (b) stopNote(b.id);
});

buildScaleUI();
</script>

</body>
</html>
